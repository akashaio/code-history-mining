<!--TODO diff d3.v2.min-2.js with existing d3 lib-->
<script src="d3.v2.min-2.js"></script>
<script src="d3.layout.cloud.js"></script>
<body>
<script>
    var solidFill = d3.scale.category10();
    var mixedFill = d3.scale.category20();
    var width = 1200;
    var height = 900;

    var lastFiles = [];
    var cloudType = window.location.search.replace( "?", "" );

    var data = /*data_placeholder*/
    {
        words: [
            {text: "aaa", size: 300},
            {text: "bbb", size: 200},
            {text: "ccc", size: 100}
        ]
    }/*data_placeholder*/;

    normalizeWordSize(data);

    d3.layout.cloud()
            .timeInterval(10)
            .size([width, height])
            .font("Impact")
            .fontSize(function(d) { return d.size; })
            .rotate(function(d) { return 0; })
            .words(data.words.map(function(d) {
                return {text: d.text, size: d.size};
            }))
            .on("end", draw)
            .start();

    function draw(words) {
        d3.select("svg").remove();
        d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2.5 + "," + height / 2.5 + ")")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function(d) { return d.size + "px"; })
                .style("font-family", "Impact")
                .style("fill", function(d, i) {
                    if (d.size > 50) return solidFill(i);
                    else return mixedFill(i);
                })
                .attr("text-anchor", "middle")
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function(d) { return d.text; });
    }

    function normalizeWordSize(data) {
        var min = d3.min(data.words, function (d) { return d.size; });
        var max = d3.max(data.words, function (d) { return d.size; });
        var range = (max != min ? max - min : 1);
        data.words = data.words.map(function (word) {
            if (word.text.length < 5) word.size += (max * 0.3) // this is to make shorter words more noticeable
            word.size = Math.round(5 + ((word.size - min) * 75 / range));
            return word;
        });
    }

</script>